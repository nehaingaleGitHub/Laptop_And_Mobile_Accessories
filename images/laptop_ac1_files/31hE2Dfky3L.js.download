'use strict';mix_d("P13NSCCards__p13n-desktop-carousel:p13n-desktop-carousel__LjplwSKM","exports tslib @c/aui-carousel @c/dom @c/remote-operations @c/scoped-dom @p/A @p/a-carousel-framework @c/browser-operations @c/metrics @c/aui-modal @c/aui-untrusted-ajax @c/logger".split(" "),function(y,k,B,C,D,E,F,G,H,t,I,J,K){function g(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var L=g(B),M=g(D),h=g(E),m=g(F),N=g(G),v=g(H),O=g(t),P=g(I),Q=g(J),q=g(K),w=function(a){t.count(a,(t.count(a)||
0)+1)},R=function(a){var c=Array.prototype.slice.call(a.querySelectorAll("[data-metrics]"));c.push(a);c.forEach(function(a){if(a&&a.dataset&&a.dataset.metrics){var b=JSON.parse(a.dataset.metrics),c;for(c in b)b.hasOwnProperty(c)&&t.count(c,b[c]);a.removeAttribute("data-metrics")}})},S=function(){var a=h["default"].cardRoot.querySelector(".p13n-edit-your-recs-button"),c=h["default"].cardRoot.querySelector(".p13n-kebab-button-edit-recs-bottom-sheet");if(c&&a){var b=v["default"].setup();O["default"].count("mobile-carousel-card:p13nEditRecsBottomSheet:rendered",
1);b.define("show-sheet","click",function(){w("mobile-carousel-card:p13nEditRecsBottomSheet:show");w("mobile-carousel-card:internal:p13nEditRecsBottomSheet:show")});b.attach("show-sheet",c);a.addEventListener("click",function(){w("mobile-carousel-card:p13nEditRecsBottomSheet:notInterested")})}},U=function(a){return k.__awaiter(void 0,void 0,void 0,function(){var c,b,d,f,e;return k.__generator(this,function(n){c=h["default"].cardRoot.querySelector(".report-problem-modal-root");if(!c)return[2];b={a11yOpenMessage:"A modal for internal users to report problems with recommendations",
hideHeader:!1};d=P["default"].create("report-flag-modal",".report-problem-modal-root",b);f=v["default"].setup();e=h["default"].cardRoot.querySelector(".report-flag");f.define("show","click",function(){d.show()});f.attach("show",e);T(a,d);return[2]})})},T=function(a,c){var b=h["default"].cardRoot.querySelector(".report-flag"),d=v["default"].setup();d.define("showFlag","mouseover",function(){b.classList.remove("report-flag-hide")});d.define("hideFlag","mouseout",function(){b.classList.add("report-flag-hide")});
d.attach("showFlag",a);d.attach("hideFlag",a);var f=h["default"].cardRoot.querySelector(".internal-flag-form");f.onsubmit=function(b){return V(f,b,a)};m["default"].on("a:dropdown:selected:internal-flag-dropdown-name",function(a){f.querySelector(".internal-flag-env-data").setAttribute("data-problem-value",a.value)});m["default"].on("a:popover:hide:"+c.id,function(){f.reset();var a=f.querySelector(".internal-flag-alias").nextSibling;a&&a.classList.contains("report-problem-message")&&(a.innerText="")})},
V=function(a,c,b){c.preventDefault();c=a.querySelector(".internal-flag-env-data").dataset;var d=a.querySelector(".internal-flag-dropdown").innerText,f=a.querySelector(".internal-flag-textarea").firstElementChild.value,e=a.querySelector(".internal-flag-alias"),n=e.value;if(void 0===a.querySelector(".internal-flag-env-data").dataset.problemValue)return x(e,!1,"Please select a problem."),!1;a=h["default"].cardRoot.querySelectorAll(".a-carousel-card");var p=W(b,a.length);b="Internal user reported issue with your widget: "+
h["default"].cardRoot.querySelector(".a-carousel-heading").innerText;d=X(a,p,d,f,n,c);Q["default"].post("https://p13ngoals.corp.amazon.com/sims",{accepts:"text/html, application/json",contentType:"application/json;charset=UTF-8"},{sim_params:{assigned_folder:"1b027359-e4c6-4e3c-92a8-0ff8a2ecb593",description:d,descriptionContentType:"text/amz-markdown-sim",tags:[{id:"internal-problem-generated"},{id:c.problemValue}],title:b}}).then(function(a){x(e,!0,a)}).catch(function(a){x(e,!1,a)});return!1},W=
function(a,c){if(!a.dataset.aCarouselOptions)return q["default"].log("Empty ASIN List in carouselElement.dataset.aCarouselOptions","ERROR"),[];a=JSON.parse(a.dataset.aCarouselOptions).ajax.id_list;var b=h["default"].cardRoot.querySelector(".a-carousel-firstvisibleitem");b=(Number(b.value)||1)-1;return a.map(function(a){return JSON.parse(a).id}).slice(b,b+c)},X=function(a,c,b,d,f,e){for(var n="",p=0;p<a.length;p++){var l=a[p].querySelector(".a-dynamic-image");n+=(l?"![]("+l.src+")":"IMAGE MISSING")+
"\nASIN: "+(c[p]?c[p]:"ASIN MISSING")+"\n\n"}return"**This SIM issue is created by the 'Report a Problem' internal tool. To know more, here's its wiki: https://w.amazon.com/bin/view/Personalization/CoreRecommendations/Projects/Canaries/Report-a-Problem-UX-on-P13NWidget/UserGuide/**\n\n**Problem:** "+(b+"\n"+(""!==d?"**Comment:** "+d+"\n":"")+"\n**Strategy ID:** "+e.strategyId+"\n**CTI:** "+e.cti+"\n**Facets:** ")+(e.facets+"\n**Content Reftag:** "+e.reftTag+"\n"+(""!==e.baseAsin?"**Page ASIN:** "+
e.baseAsin+"\n":"")+"\n"+(""!==f?"**Alias:** ["+f+"](https://phonetool.amazon.com/users/"+f+")\n":"")+"**CustomerID:** "+e.customerId)+("\n**SessionID:** "+e.sessionId+"\n**MarketplaceID:** "+e.marketplaceId+"\n**Device Type:** "+e.deviceType+"\n\n**List of ASINs:**\n\n")+n},x=function(a,c,b){var d=a.nextSibling;d&&d.classList.contains("report-problem-message")||(d=document.createElement("h5"),d.classList.add("report-problem-message"),a.after(d));c?(d.classList.remove("a-color-error"),b.responseBody&&
"object"===typeof b.responseBody?b.responseBody.response&&b.responseBody.response.id?d.innerHTML="Success, here's the <a href=\"https://issues.amazon.com/issues/"+b.responseBody.response.id+'" target="_blank">SIM issue</a> you created.':(q["default"].log("Fail to find the id of the SIM issue created in the response body of response data.","ERROR"),d.innerText="Success, but we could not find the link to the SIM."):(q["default"].log("The response body of response data is not an object.","ERROR"),d.innerText=
"Success, but we could not find the link to the SIM.")):(d.classList.add("a-color-error"),d.innerText="string"===typeof b?b:"Oops! Something went wrong. Please try again.")},z=/(?=[ \-\/])|(?=[\u3105-\u312F])|(?=[\u31A0-\u31BA])|(?=[\u4E00-\u9FD5])|(?=[\u3400-\u4DB5])|(?=[\uF900-\uFAFF])|(?=[\u3040-\u309F])|(?=[\u30A0-\u30FF])|(?=[\u3190-\u319F])/,A=/[^\/\-\[\]():\s]/,Y=function(a){var c=m["default"].$("<div>")[0];c.classList.add("p13n-sc-offscreen-truncate");var b=parseInt(a.getAttribute("data-rows")||
"2",10),d=function(){var b=a.innerHTML;a.innerHTML="&hellip;";var c=a.clientHeight;a.innerHTML=b;return c}();if(b){if(d){var f=function(a){c.innerHTML=a;return Math.round(c.clientHeight/d)<=b},e=function(b,d){b=b.split(d);var e=Math.floor(a.clientWidth/12),f=function(b){c.classList.add("p13n-sc-offscreen-truncate");c.style.overflow="hidden";c.textContent=b;a.appendChild(c);b=a.clientWidth>=a.scrollWidth;a.removeChild(c);return b},n=function(a){var b=a.length-e;a.trim().length>e&&!f(a)&&Array.prototype.slice.call(a).map(function(a,
c){return c>e&&c<=b&&A.test(a)?"&shy;"+a:a});return a};return b.map(function(a){return n(a)}).join("")};return{truncate:function(){var b=a.innerHTML.trim(),d=a.textContent||"";b=e(b,z);a.appendChild(c);if(f(b))a.removeChild(c),a.innerHTML=b;else{var l=b.split(z);for(var h=1,u=l.length,k,g,r=0;h!==u;)if(k=Math.floor((u+h)/2),g=l.slice(0,k).join("")+"&hellip;",f(g)){if(1>=u-k){for(r=k;0<r&&!A.test(l[r-1]);)r--;break}h=k}else u=k;l=0===r?void 0:l.slice(0,r).join("")+"&hellip;";l?(a.innerHTML=l,a.setAttribute("title",
d)):(q["default"].log("Unable to successfully truncate line "+b,"ERROR"),a.removeChild(c))}}}}q["default"].log("Truncation element does not have a line height or it is zero","ERROR")}else q["default"].log("Truncation element missing necessary line number data","ERROR")},Z=function(a){var c=Array.prototype.slice.call(a.getElementsByClassName("p13n-sc-truncate"));a=a.getElementsByClassName("p13n-sc-truncate-fallback");(window.CSS&&CSS.supports&&CSS.supports("-webkit-line-clamp","1")?c:c.concat(Array.prototype.slice.call(a))).filter(function(a){return!!a.offsetParent}).map(function(a){var b=
Y(a);b&&(b.truncate(),a.classList.add("p13n-sc-truncated"),a.classList.remove("p13n-sc-truncate"),a.classList.remove("p13n-sc-truncate-fallback"),a.className=a.className.replace(/p13n-sc-line-clamp-\d/g,""))})},aa={initCarousel:function(a){return k.__awaiter(void 0,void 0,void 0,function(){var c,b,d;return k.__generator(this,function(f){c=(a||{}).afterPageLoaded;b=h["default"].cardRoot.classList.contains("p13n-sc-shoveler")?[h["default"].cardRoot]:Array.prototype.slice.call(h["default"].cardRoot.getElementsByClassName("p13n-sc-shoveler"));
d=M["default"].setup(["getCarouselItems"]);if(null===b||void 0===b||!b.length)return[2];b.forEach(function(a){return k.__awaiter(void 0,void 0,void 0,function(){var b,e,f,h,g;return k.__generator(this,function(l){switch(l.label){case 0:b=function(){m["default"].loadDynamicImage("[data-name]='"+g+"' .p13n-sc-dynamic-image");Z(a);R(a);null===c||void 0===c?void 0:c(a)};b();if(a.classList.contains("p13n-carousel-initialized"))return[2];a.classList.add("p13n-carousel-initialized");e=N["default"].getCarousel(C.unscope(a));
f=L["default"].getCarousel(a);h=a.dataset||{};g=e.getAttr("name");return[4,Promise.all([f.initialized,U(a)])];case 1:return l.sent(),S(),m["default"].on("a:carousel:"+g+":change:pageSize",b),m["default"].on("a:carousel:"+g+":change:loading",b),m["default"].on("a:carousel:"+g+":change:animating",b),m["default"].on("a:carousel:"+g+":change:fetchedItems",b),f.attachRemoteOperation(function(a){var b=a.indexes;a=a.ids;return d.getCarouselItems(k.__assign(k.__assign({},h),{ids:a,indexes:b,offset:String(b[0]||
0)}))}),[2]}})})});return[2]})})}};y._operationNames=["getCarouselItems"];y.card=function(){return k.__awaiter(void 0,void 0,void 0,function(){return k.__generator(this,function(a){switch(a.label){case 0:return[4,aa.initCarousel()];case 1:return a.sent(),[2]}})})}});
